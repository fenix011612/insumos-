<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Insumos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

h2, h3 {
  margin-top: 20px;
}

input, button, select {
  padding: 8px;
  margin: 5px 0;
}

button {
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

.total {
  font-size: 18px;
  font-weight: bold;
  margin-top: 15px;
}
</style>
</head>

<body>

<h2>Controle de Insumos</h2>

<label>Descri√ß√£o:</label>
<input id="descricao" placeholder="Ex: Faixa el√°stica">

<label>Valor (R$):</label>
<input id="valor" type="number" step="0.01">

<button onclick="salvarInsumo()">Salvar</button>

<div class="total">
  Total do m√™s: R$ <span id="totalMes">0,00</span>
</div>

<table>
  <thead>
    <tr>
      <th>Descri√ß√£o</th>
      <th>Valor (R$)</th>
    </tr>
  </thead>
  <tbody id="lista"></tbody>
</table>

<h3>Comparativo de Gastos por M√™s</h3>
<canvas id="graficoMensal"></canvas>

<!-- FIREBASE + SISTEMA -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üî• CONFIGURA√á√ÉO FIREBASE (a sua) */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO.firebaseapp.com",
  databaseURL: "https://SEU_DB.firebaseio.com",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_BUCKET.appspot.com",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const agora = new Date();
const ano = agora.getFullYear();
const mes = String(agora.getMonth() + 1).padStart(2, "0");

const lista = document.getElementById("lista");
const totalMesEl = document.getElementById("totalMes");

/* üíæ SALVAR INSUMO */
window.salvarInsumo = async function () {
  const descricao = document.getElementById("descricao").value;
  const valor = Number(document.getElementById("valor").value);

  if (!descricao || !valor) return alert("Preencha tudo");

  await push(ref(db, `insumos/${ano}/${mes}`), {
    descricao,
    valor,
    data: new Date().toISOString()
  });

  document.getElementById("descricao").value = "";
  document.getElementById("valor").value = "";

  carregarMes();
  carregarGrafico();
};

/* üìÖ CARREGAR INSUMOS DO M√äS */
async function carregarMes() {
  lista.innerHTML = "";
  let total = 0;

  const snapshot = await get(ref(db, `insumos/${ano}/${mes}`));

  if (snapshot.exists()) {
    Object.values(snapshot.val()).forEach(item => {
      total += Number(item.valor);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.descricao}</td>
        <td>R$ ${item.valor.toFixed(2)}</td>
      `;
      lista.appendChild(tr);
    });
  }

  totalMesEl.innerText = total.toFixed(2);
}

/* üìä GR√ÅFICO COMPARATIVO MENSAL */
let grafico;

async function carregarGrafico() {
  const meses = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];
  let valores = [];

  for (let i = 1; i <= 12; i++) {
    const m = String(i).padStart(2, "0");
    const snap = await get(ref(db, `insumos/${ano}/${m}`));

    let soma = 0;
    if (snap.exists()) {
      Object.values(snap.val()).forEach(item => {
        soma += Number(item.valor);
      });
    }

    valores.push(soma);
  }

  const ctx = document.getElementById("graficoMensal");

  if (grafico) grafico.destroy();

  grafico = new Chart(ctx, {
    type: "bar",
    data: {
      labels: meses,
      datasets: [{
        label: "Gastos por m√™s (R$)",
        data: valores
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

/* üöÄ INICIALIZA */
carregarMes();
carregarGrafico();

</script>
</body>
</html>

