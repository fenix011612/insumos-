<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Mensal de Insumos</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyByv8SN7FXTKG9kc2jJCeYGMa86R0ZVf9g",
  authDomain: "insumos-41ece.firebaseapp.com",
  databaseURL: "https://insumos-41ece-default-rtdb.firebaseio.com",
  projectId: "insumos-41ece",
  storageBucket: "insumos-41ece.appspot.com",
  messagingSenderId: "25863524219",
  appId: "1:25863524219:web:59fff88398f535f84437de"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.db = db;
window.ref = ref;
window.push = push;
window.set = set;
window.onValue = onValue;
window.remove = remove;
</script>

<style>
body{
  font-family:Poppins,Arial;
  background:#f5f7ff;
  padding:30px;
}
h1{text-align:center;color:#5a4fcf;}
table{width:100%;border-collapse:collapse;}
th,td{padding:8px;text-align:center;}
thead{background:#5a4fcf;color:#fff;}
tbody tr:nth-child(even){background:#eef;}
input{width:100%;padding:5px;}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.add{background:#4fc3f7;}
.del{background:#ff6b6b;color:#fff;}
.total{
  margin-top:20px;
  font-size:20px;
  text-align:center;
  font-weight:600;
}
</style>
</head>

<body>

<h1>Controle Mensal de Insumos</h1>

<table>
<thead>
<tr>
  <th>Insumo</th>
  <th>Custo</th>
  <th>Qtd</th>
  <th>Data</th>
  <th>Local</th>
  <th>Pagamento</th>
  <th>Total</th>
  <th>AÃ§Ã£o</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>

<br>
<button class="add" onclick="novo()">+ Adicionar Insumo</button>

<div class="total" id="totalMes">Total do mÃªs: R$ 0,00</div>

<script>
const lista = document.getElementById("lista");
const totalMes = document.getElementById("totalMes");
const caminho = "insumos/2026/0";

function novo(){
  const novoRef = push(ref(db, caminho));
  set(novoRef,{
    insumo:"",
    custo:0,
    quantidade:0,
    data:"",
    local:"",
    pagamento:""
  });
}

function apagar(id){
  if(confirm("Deseja apagar este insumo?")){
    remove(ref(db, `${caminho}/${id}`));
  }
}

function atualizar(id,campo,valor){
  set(ref(db, `${caminho}/${id}/${campo}`), valor);
}

onValue(ref(db,caminho), snap=>{
  lista.innerHTML="";
  let soma = 0;

  snap.forEach(child=>{
    const id = child.key;
    const d = child.val();
    const total = (d.custo||0)*(d.quantidade||0);
    soma += total;

    lista.innerHTML += `
      <tr>
        <td><input value="${d.insumo||''}" 
          oninput="atualizar('${id}','insumo',this.value)"></td>

        <td><input type="number" value="${d.custo||0}" 
          oninput="atualizar('${id}','custo',Number(this.value))"></td>

        <td><input type="number" value="${d.quantidade||0}" 
          oninput="atualizar('${id}','quantidade',Number(this.value))"></td>

        <td><input type="date" value="${d.data||''}" 
          oninput="atualizar('${id}','data',this.value)"></td>

        <td><input value="${d.local||''}" 
          oninput="atualizar('${id}','local',this.value)"></td>

        <td><input value="${d.pagamento||''}" 
          oninput="atualizar('${id}','pagamento',this.value)"></td>

        <td>R$ ${total.toFixed(2)}</td>
        <td><button class="del" onclick="apagar('${id}')">ðŸ—‘</button></td>
      </tr>
    `;
  });

  totalMes.textContent = `Total do mÃªs: R$ ${soma.toFixed(2)}`;
});
</script>

</body>
</html>
